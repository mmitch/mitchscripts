# to be sourced from ~/.alias

# no localized manpages
LC_MESSAGES=C
export LC_MESSAGES

# tin singleton (avoid messing up read articles)
alias tin='if [ $(pidof tin) ] ; then echo "tin is already running..."; else /home/mitch/git/mitchscripts/bash/procrastinator.sh 1800 usenet; tin; fi'

# Trogdor!
alias sbemail.exe='mutt'

# list newest files last
alias rls='ls -rt'

# copy EXIF timestamps to file timestamps
alias exifdate2filedate='exiftool -DateTimeOriginal\>FileModifyDate'

# never start irssi without screen again
alias irssi='/home/mitch/git/mitchscripts/bash/procrastinator.sh 300 irc; screen -d -R -S irssi -t irssi irssi'

# debsign all signable files
alias debsign-all='for I in *.dsc *.changes *.commands; do [ -e "$I" ] && debsign "$I"; done'

# show latest procmail sorted mails
alias mailtail='/home/mitch/git/mitchscripts/bash/procrastinator.sh 1800 mailtail; tail -n 30 -f /home/mitch/Mail/from | { IFS=""; read FROM; while [ ! "${FROM:0:5}" = "From " ] ; do read FROM; done; read SUBJECT; while read FOLDER; do if [ "${FOLDER:0:19}" != "  Folder: /dev/null" -a "${FOLDER:0:19}" != "  Folder: spam/new/" ] ; then echo "$FROM"; echo "$SUBJECT"; echo "$FOLDER"; fi; read FROM; read SUBJECT; done } | /home/mitch/git/mitchscripts/perl/mimedecoder.pl | sed "s/^From/\nFrom/"'

# default start page in (e)links
# $1: URL (optional)
links()
{	
	(
		if [ -z "$*" ]; then
			/usr/bin/elinks http://www.mitch.h.shuttle.de/mediawiki/index.php/Hauptseite
		else
			/usr/bin/elinks "$*"
		fi
	)
}

# dump all links on a website
# $1: URL
dumpurls()
{
	lynx -dump "$@" | cut -c 7- | grep ^http:
}

# dump all pictures from an imageboard thread
# $1: URL
boardget() {
        dumpurls "$1" | egrep '\.(jpg|png|gif)$' | sort | uniq | wget -i-
}

# enable Japanese input method
# $1: command to execute
JAP()
{
	(
		XMODIFIERS="@im=kinput2"
		LC_CTYPE=ja_JP.UTF-8
		echo variables set
		export XMODIFIERS
		export LC_CTYPE
		echo variables exported
		echo -n starting kinput2
		kinput2 -xim -canna -kinput &
		echo -n .
		sleep 1
		echo -n .
		sleep 1
		echo .
		echo switching editor
		export EDITOR=jmacs
		export VISUAL=jmacs
		echo running command
		if [ -z "$@" ]; then
			x-terminal-emulator
		else
			"$@"
		fi
		echo command finished
		killall kinput2
		echo kinput2 killed
	)
}

# quick www fetch (e.g. for sites that reject wget's useragent)
# $1: URL
CHAN()
{
	GET "$1" > "$(basename "$1")"
}

# snap a window
SHOT()
{
	FILE=/tmp/shot_$(date +%Y%m%d-%H%M%S).png
	xwd | convert - $FILE
	echo $FILE
}

# snap the screen
SHOT_ALL()
{
	FILE=/tmp/shot_$(date +%Y%m%d-%H%M%S).png
	xwd -root | convert - $FILE
	echo $FILE
}

# snap a window and publish on www
SHOT_WEB()
{
	FILE=$(SHOT)
	ari_temp $FILE
	rm $FILE
}

# snap a window and publish locally
SHOT_MITCH()
{
	FILE=$(SHOT)
	mitch_temp $FILE
	rm $FILE
}

# set window title on ssh connection
ssh()
{
	xtermset -T "ssh $*"
	/usr/bin/ssh "$@"
	xtermset -T "$USER@$HOSTNAME"
}

# lookup inside WadokuJT
# $1: word
edict()
{
	grep -i "$@" /home/mitch/WadokuJT.txt | sensible-pager
}

# lookup in Pokédex™
# $1: search string
pokedex()
{
	( cd ~/git/pokedex; ./pokedex "$1" )
}

# play all my music sorted by album
# 'q' to jump to next album, '^c' to quit
albumplay()
{
	mount | grep -q /mnt/mp3 || mount /mnt/mp3
	(
		tty
		(
			find /mnt/mp3 -type d 2>/dev/null
			echo ..find 1>&2
		) | (
			unsort
			echo ..unsort 1>&2
		) | (
			sleep 2
			echo ..sleep 1>&2
			unsort
			echo ..unsort 1>&2
		)
	) | (
		read TTY
		while read DIR; do
			mplayer -shuffle "${DIR}"/* <$TTY
		done
	)
}

# quick way to renice and ionice a given process or everything maching a
# string
mynice()
{
    if [[ "$1" =~ ^[0-9]+$ ]] ; then
	renice 20 $1
	ionice -c 3 -p $1
    else
	PIDS="$(pidof "$1")"
	renice 20 $PIDS
	for PID in $PIDS ; do
	    ionice -c 3 -p $PID
	done
    fi
}